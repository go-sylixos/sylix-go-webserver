import{d as se,s as J}from"./index-3db70d7f.js";var s;(function(e){e[e.onlyTop=1]="onlyTop",e[e.preferTop=2]="preferTop",e[e.desktop=3]="desktop"})(s||(s={}));const g={active:[],deactive:[],login:[],logout:[],pay:[],orientation:[],network:[],swipe:[],token:[],permission:[],wallpaper:[],theme:[],language:[],safeArea:[],download:[]};window.addEventListener("message",e=>{const t=e.data.cmd;g[t]&&(g[t].forEach((o,c)=>{if(typeof o=="function")if(o.__edger_uid__){const p=e.data.uid;o.__edger_uid__===p&&(o(e.data.payload,e.data.error),o.__edger_done__=!0)}else o(e.data.payload,e.data.error)}),g[t]=g[t].filter(o=>o.__edger_done__!==!0))});const Q=(e,t)=>{const o=e;g[o]?g[o].push(t):g[o]=[t]},C=(e,t=s.preferTop)=>{t===s.preferTop?window.parent===window.parent.parent?(console.warn("No app shell, downgrade to desktop",e),window.parent.postMessage({...e},"*")):window.parent.parent.postMessage({...e},"*"):t===s.onlyTop?window.parent===window.parent.parent?console.warn("No app shell, ignore message",e):window.parent.parent.postMessage({...e},"*"):window.parent.postMessage({...e},"*")};let ie=0;const i=(e,t,o={timeout:1e3,ignoreResponse:!0,deliverStrategy:s.preferTop,disableTimeout:!1},c="")=>{if(!e)throw new Error("Illegal cmd");const{timeout:p=1e3,ignoreResponse:l=!0,deliverStrategy:u,disableTimeout:n=!1}=o;return new Promise((a,d)=>{if(l)C({cmd:e,payload:t,ts:Date.now()},u),a(void 0);else{const R=`${Math.random()}-${Date.now()}-${ie++}`,k=function(E,h){h?(console.error("error",h),d({error:h})):a(E)};k.__edger_uid__=R,Q(e,k),C({cmd:e,payload:t,uid:R,ts:Date.now(),scope:c},u),n||setTimeout(()=>{d({error:`Timeout ${p} with cmd ${e}`,code:"timeout"})},p||60*1e3)}})},ae=(e,t)=>(e?t(e):console.error("target object is null"),e),V=(e,t)=>{const o=g[e];o?(o.push(t),i("__edgeros_register_event__",{action:e},{deliverStrategy:s.desktop,ignoreResponse:!0})):console.warn(`The action you specified is unknown: ${e}`)};function le(e,t){if(typeof t!="function")throw new TypeError("listener must be a function");const o=g[e];return o&&(o.push(t),i("__edgeros_register_event__",{action:e},{deliverStrategy:s.desktop,ignoreResponse:!0})),this}function ce(e,t){if(typeof t!="function")throw new TypeError("listener must be a function");return g[e]&&(g[e]=g[e].filter(o=>o!==t)),this}function ue(e){return e?g[e]&&(g[e]=[]):Object.keys(g).forEach(t=>{g[t]&&(g[t]=[])}),this}function pe(e){const t=e;return this.removeAllListeners(t)}const de=e=>{if(!e)return;["info","warning","error","success"].forEach(o=>{e[o]=c=>{i("notify",{message:c,level:o},{deliverStrategy:s.desktop,ignoreResponse:!0})}})},fe=()=>i("qrscan",{},{deliverStrategy:s.preferTop,ignoreResponse:!1,timeout:5*60*1e3,disableTimeout:!0}),ge=()=>{i("qrscanStop",{},{deliverStrategy:s.preferTop,ignoreResponse:!1,timeout:10*1e3})},he=()=>i("contacts",{},{deliverStrategy:s.preferTop,ignoreResponse:!1,timeout:5*10*1e3}),me=()=>i("version",{},{deliverStrategy:s.onlyTop,ignoreResponse:!1,timeout:1*1e3}),ye=e=>i("payRequest",e,{deliverStrategy:s.desktop,ignoreResponse:!1,timeout:2*60*1e3});let r=[];const Y=e=>{const t=history[e],o=new Event(e);return function(){const c=t.apply(this,arguments);return o.arguments=arguments,window.dispatchEvent(o),c}};history.pushState=Y("pushState");history.replaceState=Y("replaceState");let M=!1,L=!1,U=0,_=0;const we=window.location.pathname,f={outApp:{mark:"outApp",title:""},logout:{mark:"logout",title:""},desktop:{mark:"desktop",title:""},indexRoute:{mark:"indexRoute",url:"",forward:"",title:window.__title||document.title}},S=(e,t)=>{e.routePosition=++_,e.url=t,e.current=t,history.pushState(e,"",t),history.go(1)},ve=()=>{r.forEach(e=>{S(e,e.url)})},$=e=>{const{pathname:t,search:o}=e.target.location;return{url:`${t}${o||""}`,mark:"route",title:window.__title||document.title}},O=(e,t={})=>{i(e,t,{ignoreResponse:!0,timeout:200,deliverStrategy:s.desktop})},b=e=>{O("title",{title:e})},Re=(e,t)=>{if(!["logout","desktop"].includes(e)){if(e==="indexRoute"){(!L||!r.length)&&t&&b(t);return}L&&(U>=r.length-1?(t&&b(t),L=!1,U=0):U++)}},Z=e=>{M=!1,S(f.outApp,e),S(f.logout,e),S(f.desktop,e),S(f.indexRoute,e),r.length&&ve()},Se=()=>{window.addEventListener("popstate",function(e){let{current:t,mark:o,back:c,forward:p,position:l,routePosition:u}=history.state;if(p=encodeURI(p),t=encodeURI(t),r.length&&(r[r.length-1],r.find(n=>n.url===t),r.findIndex(n=>n.url===t)),M)o==="logout"&&(O("logoutDesktop"),setTimeout(()=>{S(f.outApp,f.indexRoute.url)})),o==="outApp"&&(O("logoutApp"),setTimeout(()=>{S(f.outApp,f.indexRoute.url)}));else if(l){if(r.length){if(t)if(r[r.length-1]&&p===r[r.length-1].url)r.splice(r.length-1,1);else{const n=r.findIndex(a=>a.url===t);if(n>-1)r.splice(n+1,r.length-(n+1));else{const a=$(e);a.routePosition=++_,r.push(a),a.title&&b(a.title)}}}else if(!o&&t){const n=$(e);n.routePosition=++_,r.push(n),n.title&&b(n.title)}}else{if(o==="desktop"){O("miniEapSelf");return}if(r.length)if(p===r[r.length-1].url)r.splice(r.length-1,1);else{const n=r.findIndex(a=>a.url===t);if(n>-1)r.splice(n+1,r.length-(n+1));else if(o==="indexRoute")r=[];else{const a=$(e);a.routePosition=++_,r.push(a),a.title&&b(a.title)}}else if(p){const n=$(e);n.routePosition=++_,r.push(n),n.title&&b(n.title)}else if(t&&t!==f.indexRoute.url){const n=$(e);n.routePosition=++_,r.push(n),n.title&&b(n.title)}}})},ke=()=>{window.addEventListener("pushState",function(e){const{mark:t,title:o,routePosition:c}=history.state,{pathname:p,search:l}=e.target.location,u=`${p}${l||""}`;Re(t,o);const n=M||["outApp","logout","desktop","indexRoute"].includes(t),a=r.find(R=>R.url===u);if(n||a){t==="desktop"&&(f.indexRoute.url=u);return}const d=$(e);r.length?(d.back=r[r.length-1].url,r[r.length-1].forward=u,r[r.length-1].routePosition&&(_=r[r.length-1].routePosition)):(d.back=f.indexRoute.url,f.indexRoute.forward=u),d.routePosition=++_,r.push(d),b(d.title)})},Te=()=>{window.addEventListener("replaceState",function(e){const{pathname:t,search:o}=e.target.location,c=`${t}${o||""}`,{mark:p,title:l}=history.state;if(p==="indexRoute")f.indexRoute.url=c;else{const u=r.length;u&&(r[u-1].title=l||window.__title||document.title)}})},_e=()=>{window.addEventListener("message",e=>{const{cmd:t}=e.data;switch(f.indexRoute.url,t){case"active":L=!0,Z(f.indexRoute.url);break;case"deactive":M=!0,L=!1,S(f.outApp,f.indexRoute.url),S(f.logout,f.indexRoute.url),S(f.desktop,f.indexRoute.url);break}})},be=()=>{window.addEventListener("load",()=>{Z(we)})},Ee=(e,t)=>{const o=r.find(c=>c.url===e);o?o.title=t:console.warn("not find current url corresponding title")};function xe(){be(),Se(),ke(),Te(),_e()}const Ae=(e,t=!1)=>i("apps",{appids:e,ico:t},{deliverStrategy:s.desktop,ignoreResponse:!1}),Pe=(e,t)=>i("open",{target:e,letter:t},{deliverStrategy:s.desktop,ignoreResponse:!1,timeout:2*60*1e3}),$e=e=>(window.__title=e,Ee(location.href,e),i("title",{title:e},{deliverStrategy:s.desktop,ignoreResponse:!1,timeout:3*1e3})),Ce=()=>i("language",{},{deliverStrategy:s.desktop,ignoreResponse:!1}),Le=e=>i("openInBrowser",{url:e},{deliverStrategy:s.desktop,ignoreResponse:!1}),Be=()=>{i("__edgeros_register__",{},{deliverStrategy:s.desktop,ignoreResponse:!0}),i("__edgeros_register__",{},{deliverStrategy:s.onlyTop,ignoreResponse:!0})},He=e=>i("setOrientation",{type:"lock",orientation:e},{deliverStrategy:s.preferTop,ignoreResponse:!1}),Ie=()=>i("setOrientation",{type:"unlock"},{deliverStrategy:s.preferTop,ignoreResponse:!1}),Oe=()=>i("orientation",{},{deliverStrategy:s.preferTop,ignoreResponse:!1}),qe=()=>i("user",{},{ignoreResponse:!1,timeout:200,deliverStrategy:s.desktop}),De=e=>i("reqPerms",e,{ignoreResponse:!1,timeout:2*60*1e3,deliverStrategy:s.desktop}),Me=()=>i("permission",{},{ignoreResponse:!1,timeout:5*1e3,deliverStrategy:s.desktop}),Ue=()=>i("network",{},{ignoreResponse:!1,deliverStrategy:s.preferTop}),w={height:0,activeElement:{el:null,originToBottomHeight:0}};function Ne(){w.height=0,w.activeElement.el=null,w.activeElement.originToBottomHeight=0}const Fe=(e="#app",t=".van-dialog")=>window.addEventListener("message",c=>{if(c.data.cmd==="keyboardHeight"){let p=0,l=document.querySelector(e);const u=document.documentElement.clientHeight||document.body.clientHeight,n=document.activeElement;let a=document.activeElement;const d=+c.data.payload.keyboardHeight,R=document.querySelectorAll(t),k=Array.from(R).filter(h=>h.style.display!=="none")[0],E=k&&k.style.display!=="none";if(E&&(l=k,a=k,p=a.getBoundingClientRect().top),l.style.transition||(l.style.transition="margin-top .3s ease-in-out"),d||(Ne(),l.style.marginTop="0px"),d>0&&n&&(n.tagName.toUpperCase()==="INPUT"||n.tagName.toUpperCase()==="TEXTAREA")){let h=!1,x=u-a.getBoundingClientRect().bottom;if(w.height){const y=w.activeElement.originToBottomHeight;if(y){let P=0;try{P=parseFloat(getComputedStyle(l).marginTop.replace(/[px ]/g,""))}catch(re){console.error("计算keyboard marginTop出错",re)}let A=u-n.getBoundingClientRect().bottom+P,W=0,z=40;w.activeElement.el&&(z=10,W=u-w.activeElement.el.getBoundingClientRect().bottom+P-w.activeElement.originToBottomHeight),A=A-W,h=Math.abs(A-y)>z,h?x=A:x=y}}if(!h&&d<=w.height&&w.height-d<150)return;if(h||x<d){w.activeElement.el=n,w.activeElement.originToBottomHeight=x,w.height=d;let y=x-d;p>0&&(y=p-Math.abs(y)>25?y:25-p),y>=0&&(y=0),l.style.marginTop=y+"px",E||C({cmd:"switchStatusBar",payload:"hide"},s.onlyTop)}}else l.style.marginTop="0px",R.length&&Array.from(R).forEach(h=>h.style.marginTop="0px"),C({cmd:"switchStatusBar",payload:"show"},s.onlyTop)}}),je=()=>i("version",{},{ignoreResponse:!1,timeout:200,deliverStrategy:s.desktop}),We=()=>i("token",{},{ignoreResponse:!1,timeout:1e3,deliverStrategy:s.desktop}),ze=()=>i("letter",{},{ignoreResponse:!1,timeout:1e3,deliverStrategy:s.desktop}),Xe=()=>{i("ping",{},{ignoreResponse:!0,timeout:200,deliverStrategy:s.desktop})},Ge=(e=10)=>{setInterval(()=>Xe(),e*1e3)},Ke=e=>i("openAppInWorld",{target:{id:e}},{ignoreResponse:!1,timeout:2*60*1e3,deliverStrategy:s.desktop});function Je(){window.sessionStorage.getItem("entryPath")||window.sessionStorage.setItem("entryPath",window.location.href)}function Qe(){return window.sessionStorage.getItem("entryPath")}const Ve=()=>{Je(),V("swipe",function(e){(e.direction==="left"||e.direction==="right")&&(Qe()!==window.location.href?window.history.back():C({cmd:"minEap"},3))})},Ye=()=>i("theme",{},{ignoreResponse:!1,timeout:200,deliverStrategy:s.preferTop}),Ze=()=>i("env",{},{ignoreResponse:!1,timeout:1e3,deliverStrategy:s.preferTop}).then(e=>{const t=e;return t.env==="mobile"&&(t.env="edgerapp"),t}),X=["top","left","right","bottom"],q={};let F,v,B;function j(){return!("CSS"in window)||typeof CSS.supports!="function"?v="":CSS.supports("top: env(safe-area-inset-top)")?v="env":CSS.supports("top: constant(safe-area-inset-top)")?v="constant":v="",v}function ee(){if(v=typeof v=="string"?v:j(),!v){X.forEach(l=>{q[l]=0});return}function e(l,u){const n=l.style;Object.keys(u).forEach(a=>{const d=u[a];n[a]=d})}const t=[];function o(l){l?t.push(l):t.forEach(u=>{u()})}let c=!1;try{const l=Object.defineProperty({},"passive",{get:function(){c={passive:!0}}});window.addEventListener("test",null,l)}catch{}function p(l,u){const n=document.createElement("div"),a=document.createElement("div"),d=document.createElement("div"),R=document.createElement("div"),k=100,E=1e4,h={position:"absolute",width:k+"px",height:"200px",boxSizing:"border-box",overflow:"hidden",paddingBottom:`${v}(safe-area-inset-${u})`};e(n,h),e(a,h),e(d,{transition:"0s",animation:"none",width:"400px",height:"400px"}),e(R,{transition:"0s",animation:"none",width:"250%",height:"250%"}),n.appendChild(d),a.appendChild(R),l.appendChild(n),l.appendChild(a),o(()=>{n.scrollTop=a.scrollTop=E;let y=n.scrollTop,P=a.scrollTop;function A(){this.scrollTop!==(this===n?y:P)&&(n.scrollTop=a.scrollTop=E,y=n.scrollTop,P=a.scrollTop,et(u))}n.addEventListener("scroll",A,c),a.addEventListener("scroll",A,c)});const x=getComputedStyle(n);Object.defineProperty(q,u,{configurable:!0,get(){return parseFloat(x.paddingBottom)}})}B=document.createElement("div"),e(B,{position:"absolute",left:"0",top:"0",width:"0",height:"0",zIndex:"-1",overflow:"hidden",visibility:"hidden"}),X.forEach(l=>{p(B,l)}),document.body.appendChild(B),o(),F=!0}function H(e){return F||ee(),q[e]}const I=[];function et(e){I.length||setTimeout(()=>{const t={};I.forEach(o=>{t[o]=q[o]}),I.length=0,D.forEach(o=>{o(t)})},0),I.push(e)}const D=[];function tt(e){j()&&(F||ee(),typeof e=="function"&&D.push(e))}function ot(e){const t=D.indexOf(e);t>=0&&D.splice(t,1)}const T={get support(){return(typeof v=="string"?v:j()).length!=0},get top(){return H("top")},get left(){return H("left")},get right(){return H("right")},get bottom(){return H("bottom")},onChange:tt,offChange:ot},te=["top","left","right","bottom"];let N=!1;const nt=()=>{const e={top:T.top,left:T.left,right:T.right,bottom:T.bottom};te.forEach(t=>document.body.style.setProperty(`--edger-safe-area-inset-${t}`,`${e[t]}px`))},oe=()=>(N||nt(),i("safeArea",{},{ignoreResponse:!1,timeout:500,deliverStrategy:s.desktop}).then(({safeAreaInsets:t})=>(te.forEach(o=>document.body.style.setProperty(`--edger-safe-area-inset-${o}`,`${t[o]}px`)),N=!0,{safeAreaInsets:t})).catch(()=>({safeAreaInsets:{top:T.top,left:T.left,right:T.right,bottom:T.bottom}}))),G=()=>{T.onChange(e=>{if(!N){const t=Object.keys(e);Array.isArray(t)&&t.length&&t.forEach(o=>{document.body.style.setProperty(`--edger-safe-area-inset-${o}`,`${e[o]}px`)})}}),oe()};document.body?G():window.addEventListener("load",()=>{G()});const rt=(e,t,o)=>i("downloadFile",{uri:e,options:t,headers:o},{deliverStrategy:s.preferTop,ignoreResponse:!1,timeout:10*1e3}).then(c=>{const{id:p,status:l}=c;return{id:p,status:l}}),st=e=>i("downloadAbort",{id:e},{deliverStrategy:s.preferTop,ignoreResponse:!1,timeout:10*1e3}).then(t=>({success:t})).catch(()=>({success:!1})),it=e=>i("downloadState",{id:e},{deliverStrategy:s.preferTop,ignoreResponse:!1,timeout:10*1e3}).then(t=>(delete t.packageName,{...t})),at=e=>i("downloadFile",{id:e},{deliverStrategy:s.preferTop,ignoreResponse:!1,timeout:10*1e3}).then(t=>{const{id:o,status:c}=t;return{id:o,status:c}}),lt=e=>i("openFile",{id:e},{deliverStrategy:s.preferTop,ignoreResponse:!1,timeout:10*1e3}).then(t=>({success:t})).catch(()=>({success:!1})),ct={open:Pe,appworld:Ke,letter:ze,browser:Le,title:$e},ut={request:De,fetch:Me},pt={qrscan:fe,qrscanStop:ge,contacts:he,version:me},dt={download:rt,abort:st,state:it,retry:at},ft={open:lt},gt={state:Oe,lock:He,unlock:Ie},ht={pay:ye},mt={safeArea:oe},m={_on:Q,_off:pe,_emit:C,_cmd:i,onAction:V,addEventListener:le,removeEventListener:ce,removeAllListeners:ue,user:qe,avoidKeyboardOverlay:Fe,app:ct,notify:ae({},de),mobile:pt,permission:ut,payment:ht,apps:Ae,orientation:gt,network:Ue,language:Ce,version:je,token:We,enableHistoryNavigation:Ve,theme:Ye,env:Ze,layout:mt,downloadTask:dt,filesystem:ft};Ge(30);Be();xe();const ne=se({id:"securityStore",state:()=>({token:"",srand:""})});function K({token:e,srand:t}){const{token:o,srand:c}=J(ne());o.value=e,c.value=t}function yt(){m.removeEventListener("token",K),m.addEventListener("token",K)}async function wt(){try{const{token:e,srand:t}=await m.token(),{token:o,srand:c}=J(ne());o.value=e,c.value=t}catch(e){console.error(e)}}yt();function xt(){return{fetch:wt}}async function vt(){try{const{network:e}=await m.permission.fetch();if(e)return!0;const{success:t}=await m.permission.request({code:["network"],type:"permissions"});if(!t)return!1;const{network:o}=await m.permission.fetch();return o}catch(e){return console.error(e),!1}}async function Rt(){try{const{phone:{browser:e}}=await m.permission.fetch();if(e)return!0;const{success:t}=await m.permission.request({code:["browser"],type:"phone"});if(!t)return!1;const{phone:{browser:o}}=await m.permission.fetch();return o}catch(e){return console.error(e),!1}}function At(){return{requestNetwork:vt,requestOpenBrowser:Rt}}const St=(e,t,o)=>m.downloadTask.download(e,t,o),kt=e=>m.downloadTask.abort(e),Tt=e=>m.downloadTask.state(e),_t=e=>m.downloadTask.retry(e);function Pt(){return{download:St,abort:kt,state:Tt,retry:_t}}async function bt(e){try{const{success:t,error:o}=await m.app.browser(e);return o?(console.error(o),!1):t}catch(t){return console.error(t),!1}}function $t(){return{browser:bt}}export{Pt as useDownload,$t as useEdgerApp,At as usePermission,xt as useSecurity,ne as useSecurityStore};
